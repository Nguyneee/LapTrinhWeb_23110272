<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - ECSHOP Admin</title>
    <link rel="stylesheet" href="/css/dashboard-enhanced.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
<main layout:fragment="content" class="dashboard-container">
    <div class="container-fluid">
    <!-- Hero / Welcome -->
        <div class="hero p-4 p-md-5 mb-4 fade-in">
            <div class="hero-content">
        <div class="row g-4 align-items-center">
            <div class="col-lg-8">
                <h1 class="display-6 fw-bold mb-1">
                    <i class="fas fa-gauge-high me-2"></i>Bảng điều khiển
                </h1>
                <p class="lead mini-muted mb-2">
                    Chào mừng quay trở lại,
                    <span class="fw-bold" th:text="${currentUser != null ? currentUser.fullName : #authentication.name}">Admin</span>!
                </p>
                <small class="mini-muted">
                    <i class="fas fa-calendar-day me-1"></i>
                    Hôm nay: <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy')}">01/01/2025</span>
                    <span class="ms-3"><i class="fas fa-clock me-1"></i><span class="real-time-clock">--:--:--</span></span>
                </small>
            </div>
            <div class="col-lg-4 text-lg-end">
                        <div class="btn-group-vertical btn-group-lg">
                            <a class="btn btn-light btn-enhanced mb-2" th:href="@{/categories/add}">
                                <i class="fas fa-plus-circle me-2"></i>Thêm danh mục
                            </a>
                            <a class="btn btn-outline-light btn-enhanced mb-2" th:href="@{/users/add}">
                                <i class="fas fa-user-plus me-2"></i>Thêm người dùng
                            </a>
                            <a class="btn btn-outline-light btn-enhanced" th:href="@{/api-test}">
                                <i class="fas fa-code me-2"></i>API Test
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="stats-card slide-in-left">
                    <div class="card-body text-center">
                        <div class="icon-circle bg-primary text-white mx-auto mb-3">
                            <i class="fas fa-folder-plus"></i>
                        </div>
                        <h5 class="card-title">Quản lý danh mục</h5>
                        <p class="card-text text-muted">Thêm, sửa, xóa danh mục sản phẩm</p>
                        <div class="btn-group w-100">
                            <a th:href="@{/categories}" class="btn btn-primary-enhanced btn-sm">
                                <i class="fas fa-list me-1"></i>Danh sách
                            </a>
                            <a th:href="@{/categories/add}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-plus me-1"></i>Thêm mới
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card slide-in-left" style="animation-delay: 0.1s;">
                    <div class="card-body text-center">
                        <div class="icon-circle bg-success text-white mx-auto mb-3">
                            <i class="fas fa-users-cog"></i>
                        </div>
                        <h5 class="card-title">Quản lý người dùng</h5>
                        <p class="card-text text-muted">Thêm, sửa, xóa tài khoản người dùng</p>
                        <div class="btn-group w-100">
                            <a th:href="@{/users}" class="btn btn-success-enhanced btn-sm">
                                <i class="fas fa-list me-1"></i>Danh sách
                            </a>
                            <a th:href="@{/users/add}" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-plus me-1"></i>Thêm mới
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card slide-in-right" style="animation-delay: 0.2s;">
                    <div class="card-body text-center">
                        <div class="icon-circle bg-info text-white mx-auto mb-3">
                            <i class="fas fa-code"></i>
                        </div>
                        <h5 class="card-title">API Testing</h5>
                        <p class="card-text text-muted">Test các API endpoints</p>
                        <div class="btn-group w-100">
                            <a th:href="@{/api-test}" class="btn btn-info-enhanced btn-sm">
                                <i class="fas fa-play me-1"></i>Test API
                            </a>
                            <a th:href="@{/test-api.html}" class="btn btn-outline-info btn-sm" target="_blank">
                                <i class="fas fa-external-link-alt me-1"></i>Mở riêng
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card slide-in-right" style="animation-delay: 0.3s;">
                    <div class="card-body text-center">
                        <div class="icon-circle bg-warning text-white mx-auto mb-3">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <h5 class="card-title">Hệ thống</h5>
                        <p class="card-text text-muted">Cài đặt và bảo trì hệ thống</p>
                        <div class="btn-group w-100">
                            <button class="btn btn-warning-enhanced btn-sm" onclick="checkSystemHealth()">
                                <i class="fas fa-heartbeat me-1"></i>Kiểm tra
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="refreshDashboardData()">
                                <i class="fas fa-sync me-1"></i>Làm mới
                            </button>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats -->
    <div class="row g-3 mb-4">
        <div class="col-sm-6 col-xl-3">
                <div class="stats-card slide-in-left">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                                <div class="text-uppercase text-primary fw-semibold small mb-1">
                                    <i class="fas fa-folder me-1"></i>Tổng danh mục
                                </div>
                            <div class="h3 mb-0 counter" th:text="${totalCategories}">0</div>
                            <small class="text-muted">Quản lý danh mục</small>
                            </div>
                            <div class="icon-circle bg-primary text-white">
                                <i class="fas fa-folder"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent pt-0">
                        <a th:href="@{/categories}" class="btn btn-sm btn-primary-enhanced">
                            <i class="fas fa-eye me-1"></i>Xem danh mục
                        </a>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-xl-3">
                <div class="stats-card slide-in-left" style="animation-delay: 0.1s;">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                                <div class="text-uppercase text-success fw-semibold small mb-1">
                                    <i class="fas fa-users me-1"></i>Tổng người dùng
                                </div>
                            <div class="h3 mb-0 counter" th:text="${totalUsers}">0</div>
                            <small class="text-muted">Quản lý người dùng</small>
                            </div>
                            <div class="icon-circle bg-success text-white">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent pt-0">
                        <a th:href="@{/users}" class="btn btn-sm btn-success-enhanced">
                            <i class="fas fa-eye me-1"></i>Xem người dùng
                        </a>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-xl-3">
                <div class="stats-card slide-in-right" style="animation-delay: 0.2s;">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                                <div class="text-uppercase text-info fw-semibold small mb-1">
                                    <i class="fas fa-signal me-1"></i>Uptime hệ thống
                                </div>
                            <div class="h3 mb-0" th:text="${systemUptime}">99.9%</div>
                            <small class="text-muted">Ổn định hoạt động</small>
                            </div>
                            <div class="icon-circle bg-info text-white">
                                <i class="fas fa-server"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent pt-0">
                        <button class="btn btn-sm btn-info-enhanced" onclick="checkSystemHealth()">
                            <i class="fas fa-heartbeat me-1"></i>Kiểm tra hệ thống
                        </button>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-xl-3">
                <div class="stats-card slide-in-right" style="animation-delay: 0.3s;">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                                <div class="text-uppercase text-warning fw-semibold small mb-1">
                                    <i class="fas fa-chart-line me-1"></i>Hoạt động
                                </div>
                                <div class="h3 mb-0">
                                    <span class="counter" data-target="100">100</span>%
                                </div>
                            <small class="text-muted">Mức sử dụng tài nguyên</small>
                            </div>
                            <div class="icon-circle bg-warning text-white">
                                <i class="fas fa-microchip"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent pt-0">
                        <button class="btn btn-sm btn-warning-enhanced" onclick="refreshDashboardData()">
                            <i class="fas fa-rotate me-1"></i>Làm mới
                        </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row g-3 mb-4">
        <div class="col-lg-8">
                <div class="chart-card fade-in">
                <div class="card-header d-flex align-items-center justify-content-between">
                        <h6 class="mb-0 fw-bold">
                            <i class="fas fa-chart-area me-2"></i>Thống kê hoạt động
                        </h6>
                    <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-light active" onclick="changeChartPeriod('week')">Tuần</button>
                            <button class="btn btn-outline-light" onclick="changeChartPeriod('month')">Tháng</button>
                            <button class="btn btn-outline-light" onclick="changeChartPeriod('year')">Năm</button>
                        </div>
                </div>
                <div class="card-body">
                    <div class="chart-wrap"><canvas id="areaChart"></canvas></div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
                <div class="chart-card fade-in" style="animation-delay: 0.2s;">
                <div class="card-header">
                        <h6 class="mb-0 fw-bold">
                            <i class="fas fa-chart-pie me-2"></i>Phân bố danh mục
                        </h6>
                </div>
                <div class="card-body">
                    <div style="height:220px"><canvas id="pieChart"></canvas></div>
                    <div class="mt-3 small text-muted text-center">Hiển thị / Trang chủ / Ẩn</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent lists -->
    <div class="row g-3 mb-4">
        <div class="col-lg-6">
                <div class="list-card slide-in-left">
                <div class="card-header d-flex align-items-center justify-content-between">
                        <h6 class="mb-0 fw-bold">
                            <i class="fas fa-folder me-2"></i>Danh mục gần đây
                        </h6>
                        <a th:href="@{/categories}" class="btn btn-sm btn-primary-enhanced">
                            <i class="fas fa-eye me-1"></i>Xem tất cả
                        </a>
                    </div>
                    <div class="card-body">
                        <div th:if="${recentCategories.empty}" class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <h5>Chưa có danh mục</h5>
                            <p>Hãy thêm danh mục đầu tiên!</p>
                    </div>
                    <div th:if="${!recentCategories.empty}">
                        <div class="list-group list-group-flush">
                            <a th:each="category : ${recentCategories}" class="list-group-item list-group-item-action d-flex align-items-center" th:href="@{/categories/view/{id}(id=${category.id})}">
                                <div class="me-3">
                                        <img th:if="${category.image}" th:src="@{'/uploads/' + ${category.image}}" class="rounded-img" style="width:42px;height:42px;object-fit:cover;">
                                        <div th:if="${!category.image}" class="rounded bg-light d-flex align-items-center justify-content-center" style="width:42px;height:42px;">
                                            <i class="fas fa-image text-muted"></i>
                                        </div>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-semibold" th:text="${category.name}">Tên danh mục</div>
                                    <div class="small text-muted">
                                        <span th:if="${category.show}" class="badge bg-success">Hiển thị</span>
                                        <span th:unless="${category.show}" class="badge bg-secondary">Ẩn</span>
                                        <span th:if="${category.subHome}" class="badge bg-info ms-1">Trang chủ</span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
                <div class="list-card slide-in-right">
                <div class="card-header d-flex align-items-center justify-content-between">
                        <h6 class="mb-0 fw-bold">
                            <i class="fas fa-users me-2"></i>Người dùng mới
                        </h6>
                        <a th:href="@{/users}" class="btn btn-sm btn-info-enhanced">
                            <i class="fas fa-eye me-1"></i>Xem tất cả
                        </a>
                    </div>
                    <div class="card-body">
                        <div th:if="${recentUsers.empty}" class="empty-state">
                            <i class="fas fa-users"></i>
                            <h5>Chưa có người dùng</h5>
                            <p>Hãy thêm người dùng đầu tiên!</p>
                    </div>
                    <div th:if="${!recentUsers.empty}">
                        <div class="list-group list-group-flush">
                            <div th:each="user : ${recentUsers}" class="list-group-item d-flex align-items-center">
                                <div class="me-3">
                                        <img th:if="${user.avatar}" th:src="@{'/uploads/avatars/' + ${user.avatar}}" class="rounded-img" style="width:42px;height:42px;object-fit:cover;">
                                    <div th:if="${!user.avatar}" class="rounded-circle d-flex align-items-center justify-content-center bg-primary text-white" style="width:42px;height:42px;font-weight:bold;">
                                        <span th:text="${#strings.substring(user.fullName != null ? user.fullName : user.username, 0, 1).toUpperCase()}">A</span>
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-semibold" th:text="${user.fullName}">Tên người dùng</div>
                                    <div class="small text-muted">
                                        <span th:switch="${user.role.name()}">
                                            <span th:case="'ADMIN'" class="badge bg-danger">Admin</span>
                                            <span th:case="'MANAGER'" class="badge bg-warning">Manager</span>
                                            <span th:case="'USER'" class="badge bg-info">User</span>
                                        </span>
                                        <span th:if="${user.active}" class="badge bg-success ms-1">Hoạt động</span>
                                        <span th:unless="${user.active}" class="badge bg-secondary ms-1">Bị khóa</span>
                                    </div>
                                </div>
                                <div>
                                        <a th:href="@{/users/edit/{id}(id=${user.id})}" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity timeline (compact) -->
        <div class="activity-card fade-in">
        <div class="card-header">
                <h6 class="mb-0 fw-bold">
                    <i class="fas fa-history me-2"></i>Hoạt động gần đây
                </h6>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                        <div class="activity-item">
                            <div class="fw-semibold mb-1">
                                <i class="fas fa-sign-in-alt me-2 text-success"></i>Đăng nhập hệ thống
                            </div>
                        <div class="small text-muted">
                            <span th:text="${currentUser != null ? currentUser.fullName : #authentication.name}">User</span> vừa đăng nhập
                            <br><small th:text="${currentUser != null && currentUser.lastLogin != null ? #temporals.format(currentUser.lastLogin, 'dd/MM/yyyy HH:mm:ss') : ''}">Vừa xong</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                        <div class="activity-item">
                            <div class="fw-semibold mb-1">
                                <i class="fas fa-edit me-2 text-primary"></i>Cập nhật danh mục
                            </div>
                        <div class="small text-muted">Đã cập nhật giao diện danh mục sản phẩm<br><small>2 giờ trước</small></div>
                    </div>
                </div>
                <div class="col-md-3">
                        <div class="activity-item">
                            <div class="fw-semibold mb-1">
                                <i class="fas fa-database me-2 text-info"></i>Sao lưu dữ liệu
                            </div>
                        <div class="small text-muted">Hệ thống đã tự động backup<br><small>Hôm qua</small></div>
                    </div>
                </div>
                <div class="col-md-3">
                        <div class="activity-item">
                            <div class="fw-semibold mb-1">
                                <i class="fas fa-rocket me-2 text-warning"></i>Nâng cấp hệ thống
                            </div>
                        <div class="small text-muted">Đã triển khai phiên bản mới<br><small>3 ngày trước</small></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Enhanced Dashboard JavaScript -->
<script src="/js/dashboard-enhanced.js"></script>
</body>
</html>

