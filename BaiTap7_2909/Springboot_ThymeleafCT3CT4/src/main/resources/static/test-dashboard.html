<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard Enhanced</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            margin: 0.5rem 0;
        }
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .test-button {
            margin: 0.5rem;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-light">
    <div class="test-container">
        <div class="text-center mb-4">
            <h1 class="display-4 text-primary">
                <i class="fas fa-vial me-3"></i>Dashboard Enhanced Test Suite
            </h1>
            <p class="lead">Ki·ªÉm tra t·ª± ƒë·ªông c√°c t√≠nh nƒÉng c·ªßa Dashboard Enhanced</p>
        </div>

        <!-- Test Controls -->
        <div class="test-section">
            <h3><i class="fas fa-play-circle me-2"></i>Test Controls</h3>
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-primary test-button" onclick="runAllTests()">
                        <i class="fas fa-play me-2"></i>Ch·∫°y t·∫•t c·∫£ tests
                    </button>
                    <button class="btn btn-success test-button" onclick="testUI()">
                        <i class="fas fa-eye me-2"></i>Test UI Components
                    </button>
                    <button class="btn btn-info test-button" onclick="testJavaScript()">
                        <i class="fas fa-code me-2"></i>Test JavaScript
                    </button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-warning test-button" onclick="testPerformance()">
                        <i class="fas fa-tachometer-alt me-2"></i>Test Performance
                    </button>
                    <button class="btn btn-secondary test-button" onclick="testResponsive()">
                        <i class="fas fa-mobile-alt me-2"></i>Test Responsive
                    </button>
                    <button class="btn btn-danger test-button" onclick="clearResults()">
                        <i class="fas fa-trash me-2"></i>X√≥a k·∫øt qu·∫£
                    </button>
                </div>
            </div>
            
            <div class="mt-3">
                <div class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%" id="testProgress"></div>
                </div>
                <small class="text-muted">Ti·∫øn ƒë·ªô test: <span id="testProgressText">0%</span></small>
            </div>
        </div>

        <!-- Test Results -->
        <div class="test-section">
            <h3><i class="fas fa-clipboard-list me-2"></i>Test Results</h3>
            <div id="testResults">
                <div class="test-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Nh·∫•n "Ch·∫°y t·∫•t c·∫£ tests" ƒë·ªÉ b·∫Øt ƒë·∫ßu ki·ªÉm tra Dashboard Enhanced
                </div>
            </div>
        </div>

        <!-- Dashboard Preview -->
        <div class="test-section">
            <h3><i class="fas fa-desktop me-2"></i>Dashboard Preview</h3>
            <div class="alert alert-info">
                <i class="fas fa-external-link-alt me-2"></i>
                <strong>Dashboard URL:</strong> 
                <a href="/dashboard" target="_blank" class="alert-link">http://localhost:8090/dashboard</a>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                            <h5>Stats Cards</h5>
                            <p class="text-muted">4 th·∫ª th·ªëng k√™ v·ªõi animations</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <i class="fas fa-chart-pie fa-3x text-success mb-3"></i>
                            <h5>Interactive Charts</h5>
                            <p class="text-muted">Bi·ªÉu ƒë·ªì t∆∞∆°ng t√°c v·ªõi Chart.js</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <i class="fas fa-mobile-alt fa-3x text-info mb-3"></i>
                            <h5>Responsive Design</h5>
                            <p class="text-muted">T·ªëi ∆∞u cho m·ªçi thi·∫øt b·ªã</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Browser Info -->
        <div class="test-section">
            <h3><i class="fas fa-globe me-2"></i>Browser Information</h3>
            <div class="row">
                <div class="col-md-6">
                    <table class="table table-sm">
                        <tr>
                            <td><strong>User Agent:</strong></td>
                            <td id="userAgent">-</td>
                        </tr>
                        <tr>
                            <td><strong>Screen Size:</strong></td>
                            <td id="screenSize">-</td>
                        </tr>
                        <tr>
                            <td><strong>Viewport:</strong></td>
                            <td id="viewport">-</td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <table class="table table-sm">
                        <tr>
                            <td><strong>JavaScript:</strong></td>
                            <td id="javascriptSupport">-</td>
                        </tr>
                        <tr>
                            <td><strong>CSS Grid:</strong></td>
                            <td id="cssGridSupport">-</td>
                        </tr>
                        <tr>
                            <td><strong>WebGL:</strong></td>
                            <td id="webglSupport">-</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Test Suite for Dashboard Enhanced
        let testResults = [];
        let currentTest = 0;
        let totalTests = 0;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateBrowserInfo();
            addResult('info', 'Test suite ƒë√£ s·∫µn s√†ng. Nh·∫•n "Ch·∫°y t·∫•t c·∫£ tests" ƒë·ªÉ b·∫Øt ƒë·∫ßu.');
        });

        // Update browser information
        function updateBrowserInfo() {
            document.getElementById('userAgent').textContent = navigator.userAgent;
            document.getElementById('screenSize').textContent = `${screen.width}x${screen.height}`;
            document.getElementById('viewport').textContent = `${window.innerWidth}x${window.innerHeight}`;
            document.getElementById('javascriptSupport').textContent = 'Enabled';
            document.getElementById('cssGridSupport').textContent = CSS.supports('display', 'grid') ? 'Supported' : 'Not Supported';
            
            const canvas = document.createElement('canvas');
            const webgl = !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
            document.getElementById('webglSupport').textContent = webgl ? 'Supported' : 'Not Supported';
        }

        // Add test result
        function addResult(type, message, details = '') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result test-${type}`;
            
            let icon = 'fas fa-info-circle';
            if (type === 'pass') icon = 'fas fa-check-circle';
            if (type === 'fail') icon = 'fas fa-times-circle';
            
            resultDiv.innerHTML = `
                <i class="${icon} me-2"></i>
                <strong>${new Date().toLocaleTimeString()}</strong> - ${message}
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
            
            testResults.push({ type, message, details, timestamp: new Date() });
        }

        // Update progress
        function updateProgress(current, total) {
            const percentage = Math.round((current / total) * 100);
            document.getElementById('testProgress').style.width = percentage + '%';
            document.getElementById('testProgressText').textContent = percentage + '%';
        }

        // Clear results
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            testResults = [];
            currentTest = 0;
            totalTests = 0;
            updateProgress(0, 1);
            addResult('info', 'K·∫øt qu·∫£ test ƒë√£ ƒë∆∞·ª£c x√≥a.');
        }

        // Test CSS and HTML structure
        async function testUI() {
            addResult('info', 'B·∫Øt ƒë·∫ßu test UI Components...');
            
            const tests = [
                {
                    name: 'CSS Files Loaded',
                    test: () => {
                        const cssLink = document.querySelector('link[href*="dashboard-enhanced.css"]');
                        return cssLink !== null;
                    }
                },
                {
                    name: 'Bootstrap CSS',
                    test: () => {
                        const bootstrapLink = document.querySelector('link[href*="bootstrap"]');
                        return bootstrapLink !== null;
                    }
                },
                {
                    name: 'Font Awesome Icons',
                    test: () => {
                        const faLink = document.querySelector('link[href*="font-awesome"]');
                        return faLink !== null;
                    }
                },
                {
                    name: 'CSS Variables Support',
                    test: () => {
                        return CSS.supports('color', 'var(--primary-color)');
                    }
                },
                {
                    name: 'Flexbox Support',
                    test: () => {
                        return CSS.supports('display', 'flex');
                    }
                },
                {
                    name: 'Grid Support',
                    test: () => {
                        return CSS.supports('display', 'grid');
                    }
                },
                {
                    name: 'Backdrop Filter Support',
                    test: () => {
                        return CSS.supports('backdrop-filter', 'blur(10px)');
                    }
                }
            ];

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                try {
                    const result = test.test();
                    if (result) {
                        addResult('pass', `‚úì ${test.name}`, 'CSS feature ƒë∆∞·ª£c h·ªó tr·ª£');
                    } else {
                        addResult('fail', `‚úó ${test.name}`, 'CSS feature kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£');
                    }
                } catch (error) {
                    addResult('fail', `‚úó ${test.name}`, `L·ªói: ${error.message}`);
                }
                updateProgress(i + 1, tests.length);
                await sleep(100);
            }
            
            addResult('info', 'Ho√†n th√†nh test UI Components');
        }

        // Test JavaScript functionality
        async function testJavaScript() {
            addResult('info', 'B·∫Øt ƒë·∫ßu test JavaScript...');
            
            const tests = [
                {
                    name: 'JavaScript Enabled',
                    test: () => {
                        return typeof window !== 'undefined';
                    }
                },
                {
                    name: 'ES6 Support',
                    test: () => {
                        try {
                            eval('const test = () => {}; class Test {}');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'Fetch API',
                    test: () => {
                        return typeof fetch !== 'undefined';
                    }
                },
                {
                    name: 'Promise Support',
                    test: () => {
                        return typeof Promise !== 'undefined';
                    }
                },
                {
                    name: 'RequestAnimationFrame',
                    test: () => {
                        return typeof requestAnimationFrame !== 'undefined';
                    }
                },
                {
                    name: 'Performance API',
                    test: () => {
                        return typeof performance !== 'undefined';
                    }
                },
                {
                    name: 'Local Storage',
                    test: () => {
                        try {
                            localStorage.setItem('test', 'test');
                            localStorage.removeItem('test');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }
                }
            ];

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                try {
                    const result = test.test();
                    if (result) {
                        addResult('pass', `‚úì ${test.name}`, 'JavaScript feature ho·∫°t ƒë·ªông');
                    } else {
                        addResult('fail', `‚úó ${test.name}`, 'JavaScript feature kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£');
                    }
                } catch (error) {
                    addResult('fail', `‚úó ${test.name}`, `L·ªói: ${error.message}`);
                }
                updateProgress(i + 1, tests.length);
                await sleep(100);
            }
            
            addResult('info', 'Ho√†n th√†nh test JavaScript');
        }

        // Test performance
        async function testPerformance() {
            addResult('info', 'B·∫Øt ƒë·∫ßu test Performance...');
            
            const tests = [
                {
                    name: 'Page Load Time',
                    test: () => {
                        const loadTime = performance.now();
                        return loadTime < 3000; // Less than 3 seconds
                    }
                },
                {
                    name: 'Memory Usage',
                    test: () => {
                        if (performance.memory) {
                            const used = performance.memory.usedJSHeapSize / 1024 / 1024;
                            return used < 50; // Less than 50MB
                        }
                        return true; // Skip if not available
                    }
                },
                {
                    name: 'Animation Frame Rate',
                    test: () => {
                        return new Promise((resolve) => {
                            let frames = 0;
                            const start = performance.now();
                            
                            function countFrame() {
                                frames++;
                                if (performance.now() - start < 1000) {
                                    requestAnimationFrame(countFrame);
                                } else {
                                    resolve(frames >= 30); // At least 30 FPS
                                }
                            }
                            
                            requestAnimationFrame(countFrame);
                        });
                    }
                }
            ];

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                try {
                    const result = await test.test();
                    if (result) {
                        addResult('pass', `‚úì ${test.name}`, 'Performance t·ªët');
                    } else {
                        addResult('fail', `‚úó ${test.name}`, 'Performance c·∫ßn c·∫£i thi·ªán');
                    }
                } catch (error) {
                    addResult('fail', `‚úó ${test.name}`, `L·ªói: ${error.message}`);
                }
                updateProgress(i + 1, tests.length);
                await sleep(100);
            }
            
            addResult('info', 'Ho√†n th√†nh test Performance');
        }

        // Test responsive design
        async function testResponsive() {
            addResult('info', 'B·∫Øt ƒë·∫ßu test Responsive Design...');
            
            const tests = [
                {
                    name: 'Mobile Viewport',
                    test: () => {
                        return window.innerWidth < 768;
                    }
                },
                {
                    name: 'Tablet Viewport',
                    test: () => {
                        return window.innerWidth >= 768 && window.innerWidth < 1024;
                    }
                },
                {
                    name: 'Desktop Viewport',
                    test: () => {
                        return window.innerWidth >= 1024;
                    }
                },
                {
                    name: 'Touch Support',
                    test: () => {
                        return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                    }
                },
                {
                    name: 'Orientation Support',
                    test: () => {
                        return 'orientation' in screen;
                    }
                }
            ];

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                try {
                    const result = test.test();
                    if (result) {
                        addResult('pass', `‚úì ${test.name}`, 'Responsive feature ho·∫°t ƒë·ªông');
                    } else {
                        addResult('fail', `‚úó ${test.name}`, 'Responsive feature kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£');
                    }
                } catch (error) {
                    addResult('fail', `‚úó ${test.name}`, `L·ªói: ${error.message}`);
                }
                updateProgress(i + 1, tests.length);
                await sleep(100);
            }
            
            addResult('info', 'Ho√†n th√†nh test Responsive Design');
        }

        // Run all tests
        async function runAllTests() {
            clearResults();
            addResult('info', 'üöÄ B·∫Øt ƒë·∫ßu ch·∫°y t·∫•t c·∫£ tests...');
            
            const testSuites = [
                { name: 'UI Components', func: testUI },
                { name: 'JavaScript', func: testJavaScript },
                { name: 'Performance', func: testPerformance },
                { name: 'Responsive Design', func: testResponsive }
            ];

            for (let i = 0; i < testSuites.length; i++) {
                const suite = testSuites[i];
                addResult('info', `üìã Ch·∫°y test suite: ${suite.name}`);
                await suite.func();
                await sleep(500);
            }
            
            // Generate summary
            const passCount = testResults.filter(r => r.type === 'pass').length;
            const failCount = testResults.filter(r => r.type === 'fail').length;
            const totalCount = passCount + failCount;
            
            addResult('info', `üìä T·ªïng k·∫øt: ${passCount}/${totalCount} tests passed`);
            
            if (failCount === 0) {
                addResult('pass', 'üéâ T·∫•t c·∫£ tests ƒë·ªÅu PASS! Dashboard Enhanced ho·∫°t ƒë·ªông t·ªët.');
            } else {
                addResult('fail', `‚ö†Ô∏è C√≥ ${failCount} tests FAILED. Vui l√≤ng ki·ªÉm tra l·∫°i.`);
            }
        }

        // Utility function
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Test dashboard connection
        async function testDashboardConnection() {
            try {
                const response = await fetch('/dashboard');
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // Auto-test on load
        window.addEventListener('load', async function() {
            addResult('info', 'üîç Ki·ªÉm tra k·∫øt n·ªëi Dashboard...');
            const connected = await testDashboardConnection();
            if (connected) {
                addResult('pass', '‚úì Dashboard c√≥ th·ªÉ truy c·∫≠p', 'URL: /dashboard');
            } else {
                addResult('fail', '‚úó Kh√¥ng th·ªÉ k·∫øt n·ªëi Dashboard', 'Vui l√≤ng ki·ªÉm tra server');
            }
        });
    </script>
</body>
</html>
